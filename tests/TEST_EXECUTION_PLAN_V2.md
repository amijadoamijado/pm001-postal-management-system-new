
## PM001 郵便物発送管理システム テスト計画書

### 1. テストの目的

本テスト計画は、Google Apps Script（GAS）で構築された「郵便物発送管理システム」が、定義された機能要件（料金体系、宛名選択、発送管理、顧客DB）をすべて満たし、小規模運用（最大80名、同時5名）において安定的かつ正確に動作することを包括的に検証します。

### 2. テスト範囲

- **対象機能**:
    - **料金計算ロジック**: `calculateShippingFeeNew` 関数の全分岐を網羅するテスト。
    - **宛名選択機能**: 4つの異なる選択パターン（顧客DB、ユーザー履歴、全体履歴、新規登録）の動作確認。
    - **発送記録・管理**: 追跡番号を含む発送記録の保存、および履歴の正確な更新。
    - **顧客データベース**: 会社名を含む顧客情報の登録と、部分一致検索の検証。
    - **データ連携**: GASとGoogle Spreadsheet間のデータ読み書きの整合性確認。
- **対象外**:
    - GASの実行時間や同時実行数などの負荷テスト（技術仕様書にて余裕度が確認されているため）。
    - フロントエンドのUI/UXテスト（HTMLファイルが単一でシンプルなため、機能テストに内包）。

### 3. テスト体制

- **テスト実行者**: 行政権 (Gemini)
- **テスト監督・承認者**: 司法権 (Gemini)

### 4. テスト環境

- **プラットフォーム**: Google Apps Script
- **データベース**: Google Spreadsheet
- **実行環境**: Googleアカウントにログインした状態のブラウザ (Google Chrome)

### 5. テストケース

#### 5.1. サーバーサイド単体テスト (GAS関数レベル)

| テストID | 対象関数 | テスト項目 | 入力データ | 期待される結果 |
| :--- | :--- | :--- | :--- | :--- |
| UT-GS-001 | `calculateShippingFeeNew` | 普通郵便（規格内）50g | `{ weight: 50, shippingMethod: 'standard_regular' }` | `140` |
| UT-GS-002 | `calculateShippingFeeNew` | 普通郵便（規格内）250g + 速達 | `{ weight: 250, shippingMethod: 'standard_regular', isExpress: true }` | `570` (320 + 250) |
| UT-GS-003 | `calculateShippingFeeNew` | 普通郵便（規格外）150g | `{ weight: 150, shippingMethod: 'standard_irregular' }` | `390` |
| UT-GS-004 | `calculateShippingFeeNew` | レターパックライト | `{ shippingMethod: 'letterpack' }` | `430` |
| UT-GS-005 | `saveCustomer` | 会社名を含む顧客を登録 | `{ name: 'テスト太郎', email: 'test@example.com', companyName: 'テスト株式会社' }` | 顧客シートに会社名を含む行が追加される。 |
| UT-GS-006 | `saveShipping` | レターパックライト（追跡番号あり）を記録 | `{ ..., shippingMethod: 'letterpack', trackingNumber: '1234-5678-9012' }` | 発送記録シートに追跡番号が記録される。 |
| UT-GS-007 | `saveShipping` | 発送記録と同時に履歴が更新される | `{ ..., userId: 'testUser', addressId: 'testAddress' }` | `UserHistory` と `AddressUsage` シートの該当レコードの使用回数が増加し、最終使用日が更新される。 |
| UT-GS-008 | `searchCustomers` | 会社名で検索 | `searchQuery: 'テスト株式会社'` | UT-GS-005で登録した顧客がヒットする。 |
| UT-GS-009 | `searchCustomers` | 宛名で検索 | `searchQuery: 'テスト宛名'` | 該当する宛名情報を持つ顧客がヒットする。 |

#### 5.2. 結合テスト (UI経由でのシナリオ)

テストの実行には、GASのウェブアプリとしてデプロイし、ブラウザから操作する必要があります。

| テストID | シナリオ | 操作手順 | 期待される結果 |
| :--- | :--- | :--- | :--- |
| IT-001 | **新規顧客・新規宛名での発送** | 1. 宛名選択で「新規宛名登録」を選択。<br>2. 顧客情報（会社名含む）、宛名情報を入力。<br>3. 発送方法「普通郵便（規格内）」、重量「80g」を選択。<br>4. 発送記録を保存。 | 1. 料金が「180円」と自動計算される。<br>2. `Customers` `Addresses` `Shipping` の各シートに新しいデータが1行ずつ追加される。<br>3. `UserHistory` `AddressUsage` に新しい履歴が記録される。 |
| IT-002 | **既存顧客（DB検索）への発送** | 1. 宛名選択で「顧客データベースから選択」を選択。<br>2. 検索ボックスにIT-001で登録した会社名の一部を入力。<br>3. 検索結果から該当顧客を選択。<br>4. 発送方法「レターパックライト」を選択し、追跡番号を入力。<br>5. 発送記録を保存。 | 1. 料金が「430円」と自動計算される。<br>2. `Shipping` シートに新しいデータが追加され、追跡番号が記録されている。<br>3. IT-001で作成された `UserHistory` `AddressUsage` の使用回数が増加する。 |
| IT-003 | **ユーザー履歴からの発送** | 1. 宛名選択で「ログインユーザーの過去履歴から選択」を選択。<br>2. IT-002で使用した宛名が表示されていることを確認し、選択。<br>3. 発送方法「普通郵便（規格外）」、重量「200g」、速達オプションを選択。<br>4. 発送記録を保存。 | 1. 料金が「700円」（450 + 250）と自動計算される。<br>2. `Shipping` シートに新しいデータが追加される。<br>3. 該当の履歴の使用回数がさらに増加する。 |
| IT-004 | **全体履歴からの発送** | 1. 宛名選択で「全員の過去履歴から選択」を選択。<br>2. IT-003で使用した宛名が、使用回数が多い順で上位に表示されていることを確認し、選択。<br>3. 発送を実行。 | 1. 正常に発送記録が保存される。<br>2. 該当の履歴の使用回数がさらに増加する。 |
| IT-005 | **異常系：必須項目未入力** | 1. 宛名や発送方法を選択せずに「発送記録を保存」ボタンをクリック。 | 1. エラーメッセージが表示され、処理が中断される。<br>2. スプレッドシートにデータは書き込まれない。 |

### 6. テストデータ

- **顧客データ**:
    - `テスト顧客A` (会社名あり)
    - `テスト顧客B` (会社名なし)
- **宛名データ**:
    - `テスト顧客A` に紐づく宛名2件
    - `テスト顧客B` に紐づく宛名1件
- **ユーザー**:
    - `testUser1@example.com`
    - `testUser2@example.com`

### 7. テストの開始・終了基準

- **開始基準**:
    - GASプロジェクトがウェブアプリとしてデプロイされ、URLが発行されていること。
    - テスト用のGoogle Spreadsheetが準備されていること。
    - 本テスト計画が承認されること。
- **終了基準**:
    - 上記の全テストケースが消化されること。
    - 発見された不具合がすべて修正され、再テストで問題ないことが確認されること。
    - テスト結果レポートが作成され、承認されること。

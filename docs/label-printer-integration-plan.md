# Brotherè£½ãƒ©ãƒ™ãƒ«ãƒ—ãƒªãƒ³ã‚¿ãƒ¼é€£æºå®Ÿè£…è¨ˆç”»

## ğŸ¯ æ¦‚è¦
éƒµä¾¿ç‰©ç™ºé€ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã«Brotherè£½ãƒ©ãƒ™ãƒ«ãƒ—ãƒªãƒ³ã‚¿ãƒ¼ã¨ã®é€£æºæ©Ÿèƒ½ã‚’è¿½åŠ ã—ã€ç™ºé€ç™»éŒ²ã¨åŒæ™‚ã«å®›åãƒ©ãƒ™ãƒ«ã‚’è‡ªå‹•å°åˆ·ã™ã‚‹ä»•çµ„ã¿ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

## ğŸ“‹ è¦ä»¶å®šç¾©

### æ©Ÿèƒ½è¦ä»¶
1. **è‡ªå‹•ãƒ©ãƒ™ãƒ«å°åˆ·**
   - ç™ºé€ç™»éŒ²ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ã§å®›åãƒ©ãƒ™ãƒ«è‡ªå‹•å°åˆ·
   - å°åˆ·ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½
   - å°åˆ·æšæ•°æŒ‡å®šæ©Ÿèƒ½

2. **ãƒ©ãƒ™ãƒ«ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ**
   - éƒµä¾¿ç•ªå·ï¼ˆã€’ãƒãƒ¼ã‚¯ä»˜ãï¼‰
   - é€ä»˜å…ˆä½æ‰€ï¼ˆéƒ½é“åºœçœŒã‹ã‚‰ï¼‰
   - å®›åï¼ˆæ§˜ãƒ»å¾¡ä¸­ã®è‡ªå‹•åˆ¤å®šï¼‰
   - ä¼šç¤¾åï¼ˆã‚ã‚‹å ´åˆï¼‰
   - å·®å‡ºäººæƒ…å ±ï¼ˆå›ºå®šã¾ãŸã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¥ï¼‰

3. **å¯¾å¿œãƒ—ãƒªãƒ³ã‚¿ãƒ¼**
   - Brother QLã‚·ãƒªãƒ¼ã‚ºï¼ˆQL-800ã€QL-820NWBãªã©ï¼‰
   - å¯¾å¿œãƒ©ãƒ™ãƒ«ã‚µã‚¤ã‚ºï¼š103Ã—164mmï¼ˆå®›åãƒ©ãƒ™ãƒ«ï¼‰

### éæ©Ÿèƒ½è¦ä»¶
1. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**
   - å°åˆ·é–‹å§‹ã¾ã§3ç§’ä»¥å†…
   - è¤‡æ•°æšé€£ç¶šå°åˆ·å¯¾å¿œ

2. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**
   - ãƒ—ãƒªãƒ³ã‚¿ãƒ¼æœªæ¥ç¶šæ™‚ã®è­¦å‘Š
   - ç”¨ç´™åˆ‡ã‚Œé€šçŸ¥
   - å°åˆ·å¤±æ•—æ™‚ã®å†å°åˆ·æ©Ÿèƒ½

## ğŸ—ï¸ ã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆ

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Webãƒ–ãƒ©ã‚¦ã‚¶    â”‚â”€â”€â”€â”€â–¶â”‚  Google Apps    â”‚â”€â”€â”€â”€â–¶â”‚ ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆ  â”‚
â”‚  (ç™ºé€å…¥åŠ›ç”»é¢)  â”‚     â”‚    Script       â”‚     â”‚  (ãƒ‡ãƒ¼ã‚¿ä¿å­˜)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                        â”‚
         â”‚                        â”‚ ãƒ©ãƒ™ãƒ«ãƒ‡ãƒ¼ã‚¿
         â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ãƒ­ãƒ¼ã‚«ãƒ«å°åˆ·     â”‚â—€â”€â”€â”€â”€â”‚   å°åˆ·ãƒ‡ãƒ¼ã‚¿     â”‚
â”‚  ã‚µãƒ¼ãƒ“ã‚¹        â”‚     â”‚   (JSON/CSV)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Brother         â”‚
â”‚ ãƒ©ãƒ™ãƒ«ãƒ—ãƒªãƒ³ã‚¿ãƒ¼ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å®Ÿè£…æ–¹å¼ã®é¸æŠè‚¢

#### æ–¹å¼1: Chromeæ‹¡å¼µæ©Ÿèƒ½æ–¹å¼
- **ãƒ¡ãƒªãƒƒãƒˆ**: ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒç°¡å˜ã€ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å¯¾å¿œ
- **ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ**: æ‹¡å¼µæ©Ÿèƒ½ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå¿…è¦
- **æ¨å¥¨åº¦**: â˜…â˜…â˜…â˜…â˜†

#### æ–¹å¼2: Electronã‚¢ãƒ—ãƒªæ–¹å¼
- **ãƒ¡ãƒªãƒƒãƒˆ**: å®Œå…¨ãªåˆ¶å¾¡ãŒå¯èƒ½ã€ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ³ã‚¢ãƒ—ãƒª
- **ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ**: åˆ¥é€”ã‚¢ãƒ—ãƒªé–‹ç™ºãŒå¿…è¦
- **æ¨å¥¨åº¦**: â˜…â˜…â˜…â˜†â˜†

#### æ–¹å¼3: Brother b-PACæ–¹å¼ï¼ˆWindowsé™å®šï¼‰
- **ãƒ¡ãƒªãƒƒãƒˆ**: Brotherå…¬å¼SDKã€é«˜æ©Ÿèƒ½
- **ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ**: Windowsé™å®šã€ActiveXä¾å­˜
- **æ¨å¥¨åº¦**: â˜…â˜…â˜…â˜†â˜†

## ğŸ’» å®Ÿè£…è©³ç´°

### 1. GASå´ã®å®Ÿè£…

```javascript
// ãƒ©ãƒ™ãƒ«ãƒ‡ãƒ¼ã‚¿ç”ŸæˆAPI
function generateLabelDataAPI(shippingId) {
  const shipping = Database.getShipping(shippingId);
  const address = Database.getAddresses(shipping.addressId);
  const customer = Database.getCustomers(shipping.customerId);
  
  const labelData = {
    id: Utilities.getUuid(),
    timestamp: new Date().toISOString(),
    
    // é€ä»˜å…ˆæƒ…å ±
    recipient: {
      postalCode: formatPostalCode(address.zipCode),
      address1: address.address,
      address2: address.buildingName || '',
      name: address.recipientName + determineSuffix(customer),
      company: customer.companyName || ''
    },
    
    // å·®å‡ºäººæƒ…å ±
    sender: getSenderInfo(),
    
    // å°åˆ·è¨­å®š
    settings: {
      printerName: 'Brother QL-800',
      labelSize: '103x164',
      copies: 1,
      orientation: 'landscape',
      darkness: 0 // å°å­—æ¿ƒåº¦
    },
    
    // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
    metadata: {
      shippingId: shippingId,
      shippingMethod: shipping.shippingMethod,
      trackingNumber: shipping.trackingNumber || null
    }
  };
  
  return labelData;
}

// æ•¬ç§°ã®è‡ªå‹•åˆ¤å®š
function determineSuffix(customer) {
  if (customer.companyName) {
    return ' å¾¡ä¸­';
  } else {
    return ' æ§˜';
  }
}

// éƒµä¾¿ç•ªå·ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
function formatPostalCode(zipCode) {
  return 'ã€’' + zipCode;
}
```

### 2. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å´ã®å®Ÿè£…

```javascript
// ç™ºé€ç™»éŒ²ï¼‹ãƒ©ãƒ™ãƒ«å°åˆ·
async function submitShippingWithLabel() {
  try {
    // 1. ç™ºé€ãƒ‡ãƒ¼ã‚¿ç™»éŒ²
    const shippingResult = await submitShipping();
    
    if (shippingResult.success) {
      // 2. ãƒ©ãƒ™ãƒ«ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
      const labelData = await generateLabelData(shippingResult.data.id);
      
      // 3. å°åˆ·ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º
      const confirmed = await showPrintPreview(labelData);
      
      if (confirmed) {
        // 4. ãƒ­ãƒ¼ã‚«ãƒ«å°åˆ·ã‚µãƒ¼ãƒ“ã‚¹ã«é€ä¿¡
        await sendToPrinter(labelData);
        
        showSuccess('ç™ºé€ç™»éŒ²ã¨ãƒ©ãƒ™ãƒ«å°åˆ·ãŒå®Œäº†ã—ã¾ã—ãŸ');
      }
    }
  } catch (error) {
    showError('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
  }
}

// å°åˆ·ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
function showPrintPreview(labelData) {
  const previewHtml = `
    <div class="label-preview" style="width: 164mm; height: 103mm; border: 1px solid #000; padding: 10mm;">
      <div class="postal-code" style="font-size: 14pt; margin-bottom: 5mm;">
        ${labelData.recipient.postalCode}
      </div>
      <div class="address" style="font-size: 12pt; margin-bottom: 3mm;">
        ${labelData.recipient.address1}<br>
        ${labelData.recipient.address2}
      </div>
      <div class="company" style="font-size: 14pt; margin-bottom: 2mm;">
        ${labelData.recipient.company}
      </div>
      <div class="name" style="font-size: 18pt; font-weight: bold;">
        ${labelData.recipient.name}
      </div>
      <div class="sender" style="position: absolute; bottom: 10mm; right: 10mm; font-size: 9pt;">
        ${labelData.sender.postalCode}<br>
        ${labelData.sender.address}<br>
        ${labelData.sender.company}<br>
        ${labelData.sender.name}
      </div>
    </div>
  `;
  
  // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
  return showModal('å°åˆ·ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼', previewHtml, ['å°åˆ·', 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«']);
}
```

### 3. ãƒ­ãƒ¼ã‚«ãƒ«å°åˆ·ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆChromeæ‹¡å¼µæ©Ÿèƒ½æ¡ˆï¼‰

```javascript
// manifest.json
{
  "manifest_version": 3,
  "name": "éƒµä¾¿ç‰©ç™ºé€ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  - ãƒ©ãƒ™ãƒ«å°åˆ·",
  "version": "1.0",
  "permissions": ["printerProvider"],
  "background": {
    "service_worker": "background.js"
  }
}

// background.js
chrome.runtime.onMessageExternal.addListener(
  function(request, sender, sendResponse) {
    if (request.action === "printLabel") {
      printLabelWithBrother(request.labelData)
        .then(result => sendResponse({success: true, result: result}))
        .catch(error => sendResponse({success: false, error: error.message}));
      return true; // éåŒæœŸãƒ¬ã‚¹ãƒãƒ³ã‚¹
    }
  }
);

async function printLabelWithBrother(labelData) {
  // Brother Web SDK ã‚’ä½¿ç”¨ã—ãŸå°åˆ·å®Ÿè£…
  const printer = new BrotherPrinter();
  await printer.connect(labelData.settings.printerName);
  
  const label = printer.createLabel(labelData.settings.labelSize);
  
  // ãƒ†ã‚­ã‚¹ãƒˆé…ç½®
  label.addText(labelData.recipient.postalCode, {x: 10, y: 10, fontSize: 14});
  label.addText(labelData.recipient.address1, {x: 10, y: 30, fontSize: 12});
  label.addText(labelData.recipient.name, {x: 10, y: 60, fontSize: 18, bold: true});
  
  // å°åˆ·å®Ÿè¡Œ
  return await printer.print(label, labelData.settings.copies);
}
```

## ğŸ“… å®Ÿè£…ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—

### Phase 1: åŸºæœ¬å®Ÿè£…ï¼ˆ2é€±é–“ï¼‰
- [ ] GASå´ã®ãƒ©ãƒ™ãƒ«ãƒ‡ãƒ¼ã‚¿ç”ŸæˆAPIå®Ÿè£…
- [ ] å°åˆ·ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½å®Ÿè£…
- [ ] æ‰‹å‹•ã§ã®CSVãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½

### Phase 2: è‡ªå‹•å°åˆ·å®Ÿè£…ï¼ˆ3é€±é–“ï¼‰
- [ ] Chromeæ‹¡å¼µæ©Ÿèƒ½é–‹ç™º
- [ ] Brother Web SDKçµ±åˆ
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å®Ÿè£…

### Phase 3: é«˜åº¦ãªæ©Ÿèƒ½ï¼ˆ2é€±é–“ï¼‰
- [ ] è¤‡æ•°ãƒ©ãƒ™ãƒ«ä¸€æ‹¬å°åˆ·
- [ ] ã‚«ã‚¹ã‚¿ãƒ ãƒ©ãƒ™ãƒ«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
- [ ] å°åˆ·å±¥æ­´ç®¡ç†

## ğŸ¯ æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ

1. **ä½œæ¥­åŠ¹ç‡å‘ä¸Š**
   - æ‰‹æ›¸ãä½œæ¥­ã®å®Œå…¨æ’é™¤
   - ç™ºé€ä½œæ¥­æ™‚é–“ã‚’50%å‰Šæ¸›

2. **å“è³ªå‘ä¸Š**
   - å®›åã®èª¤è¨˜é˜²æ­¢
   - çµ±ä¸€ã•ã‚ŒãŸãƒ©ãƒ™ãƒ«å“è³ª

3. **ã‚³ã‚¹ãƒˆå‰Šæ¸›**
   - å®›åã‚·ãƒ¼ãƒ«è³¼å…¥è²»ç”¨å‰Šæ¸›
   - ä½œæ¥­äººä»¶è²»å‰Šæ¸›

## ğŸ“ è£œè¶³äº‹é …

- Brother QL-800ã¯103Ã—164mmã®å®›åãƒ©ãƒ™ãƒ«ã«å¯¾å¿œ
- ãƒ¬ã‚¿ãƒ¼ãƒ‘ãƒƒã‚¯ãƒ©ã‚¤ãƒˆã®å ´åˆã¯è¿½è·¡ç•ªå·ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã‚‚å°åˆ·å¯èƒ½
- å°†æ¥çš„ã«ã¯QRã‚³ãƒ¼ãƒ‰ï¼ˆè¿½è·¡ç”¨ï¼‰ã®å°åˆ·ã‚‚æ¤œè¨
# PM001 éƒµä¾¿ç‰©ç™ºé€ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  æŠ€è¡“ä»•æ§˜æ›¸ã€GASå°è¦æ¨¡é‹ç”¨ç‰ˆã€‘

## ğŸ“‹ ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦
- **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆID**: PM001
- **ã‚·ã‚¹ãƒ†ãƒ å**: éƒµä¾¿ç‰©ç™ºé€ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 
- **å¯¾è±¡è¦æ¨¡**: æœ€å¤§80ååˆ©ç”¨ã€åŒæ™‚æ¥ç¶š5åç¨‹åº¦
- **æŠ€è¡“åŸºç›¤**: Google Apps Scriptï¼ˆGASï¼‰å®Œå…¨ç‰¹åŒ–
- **é‹ç”¨ã‚³ã‚¹ãƒˆ**: å®Œå…¨ç„¡æ–™
- **ä½œæˆæ—¥**: 2025å¹´7æœˆ3æ—¥

---

## ğŸ¯ å°è¦æ¨¡é‹ç”¨ã«æœ€é©åŒ–ã•ã‚ŒãŸGASè¨­è¨ˆ

### åˆ©ç”¨è€…è¦æ¨¡ã®ç‰¹å¾´
- **ç·åˆ©ç”¨è€…**: 80åï¼ˆæœˆé–“ï¼‰
- **åŒæ™‚æ¥ç¶š**: æœ€å¤§5å
- **åˆ©ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³**: æ¥­å‹™æ™‚é–“ä¸­ã®æ•£ç™ºçš„åˆ©ç”¨
- **ãƒ‡ãƒ¼ã‚¿å¢—åŠ **: å¹´é–“æ•°åƒä»¶ãƒ¬ãƒ™ãƒ«

### GASå°è¦æ¨¡é‹ç”¨ã®ãƒ¡ãƒªãƒƒãƒˆ
1. **ã‚³ã‚¹ãƒˆ**: å®Œå…¨ç„¡æ–™é‹ç”¨å¯èƒ½
2. **ç®¡ç†**: ã‚µãƒ¼ãƒãƒ¼ç®¡ç†ãƒ»ä¿å®ˆä¸è¦
3. **å¯ç”¨æ€§**: Google ã‚¤ãƒ³ãƒ•ãƒ©ã®99.9%ç¨¼åƒç‡
4. **æ‹¡å¼µæ€§**: åˆ©ç”¨è€…å¢—åŠ ã«è‡ªå‹•å¯¾å¿œ
5. **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: Googleæ¨™æº–ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

---

## ğŸ—ï¸ å°è¦æ¨¡ç‰¹åŒ–ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ
```
ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼å±¤ã€‘80åï¼ˆåŒæ™‚æœ€å¤§5åï¼‰
    â†“ HTTPS
ã€Google Apps Script WebAppã€‘
    â†“ Spreadsheet API
ã€Google Spreadsheet Databaseã€‘
    â†“ Google Drive
ã€è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã€‘
```

### GASåˆ¶é™ã¨å°è¦æ¨¡é‹ç”¨ã§ã®ä½™è£•åº¦

| GASåˆ¶é™é …ç›® | åˆ¶é™å€¤ | å°è¦æ¨¡é‹ç”¨ã§ã®ä½¿ç”¨é‡ | ä½™è£•åº¦ |
|------------|--------|-------------------|--------|
| å®Ÿè¡Œæ™‚é–“ | 6åˆ†/å› | å¹³å‡3ç§’/å› | **99%ä½™è£•** |
| åŒæ™‚å®Ÿè¡Œ | 30å®Ÿè¡Œ | æœ€å¤§5å®Ÿè¡Œ | **83%ä½™è£•** |
| ãƒˆãƒªã‚¬ãƒ¼ | 20å€‹ | 3-5å€‹ä½¿ç”¨ | **75%ä½™è£•** |
| ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œ/æ—¥ | 6æ™‚é–“ | 10-20åˆ†/æ—¥ | **95%ä½™è£•** |
| ãƒ¡ãƒ¼ãƒ«é€ä¿¡/æ—¥ | 100é€š | 0-10é€š/æ—¥ | **90%ä½™è£•** |

### å°è¦æ¨¡æœ€é©åŒ–ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ
```
PM001-PostalSystem/
â”œâ”€â”€ appsscript.json          # åŸºæœ¬è¨­å®š
â”œâ”€â”€ Code.gs                  # ãƒ¡ã‚¤ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆè»½é‡åŒ–ï¼‰
â”œâ”€â”€ Database.gs              # Spreadsheetæ“ä½œï¼ˆã‚·ãƒ³ãƒ—ãƒ«ï¼‰
â”œâ”€â”€ WebApp.gs                # Webåˆ¶å¾¡ï¼ˆåŸºæœ¬æ©Ÿèƒ½ï¼‰
â”œâ”€â”€ Utils.gs                 # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ï¼ˆæœ€å°é™ï¼‰
â””â”€â”€ index.html               # UIï¼ˆå˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
```

---

## ğŸ“Š å°è¦æ¨¡ç‰¹åŒ–ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

### Spreadsheetæ§‹æˆï¼ˆè»½é‡è¨­è¨ˆï¼‰
```javascript
const DB_CONFIG = {
  SPREADSHEET_NAME: 'PM001-PostalSystem-DB',
  SHEETS: {
    CUSTOMERS: 'Customers',      // é¡§å®¢ãƒã‚¹ã‚¿ï¼ˆ~500ä»¶æƒ³å®šï¼‰
    ADDRESSES: 'Addresses',      // å®›åãƒ‡ãƒ¼ã‚¿ï¼ˆ~1000ä»¶æƒ³å®šï¼‰
    SHIPPING: 'Shipping',        // ç™ºé€è¨˜éŒ²ï¼ˆ~5000ä»¶/å¹´æƒ³å®šï¼‰
    USER_HISTORY: 'UserHistory', // ãƒ¦ãƒ¼ã‚¶ãƒ¼å±¥æ­´ï¼ˆ~2000ä»¶æƒ³å®šï¼‰
    ADDRESS_USAGE: 'AddressUsage', // ä½¿ç”¨çµ±è¨ˆï¼ˆ~1000ä»¶æƒ³å®šï¼‰
    SYSTEM_LOG: 'SystemLog'      // ã‚·ã‚¹ãƒ†ãƒ ãƒ­ã‚°ï¼ˆ~1000ä»¶æƒ³å®šï¼‰
  },
  MAX_RECORDS_PER_SHEET: 10000, // å®‰å…¨ãƒãƒ¼ã‚¸ãƒ³
  CACHE_DURATION: 600 // 10åˆ†ï¼ˆå°è¦æ¨¡ãªã®ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥é•·ã‚ï¼‰
};
```

### ãƒ‡ãƒ¼ã‚¿é‡è¦‹ç©ã‚‚ã‚Š
```javascript
/**
 * å°è¦æ¨¡é‹ç”¨ãƒ‡ãƒ¼ã‚¿é‡è¦‹ç©ã‚‚ã‚Š
 */
const DATA_ESTIMATES = {
  customers: {
    current: 80,      // ç¾åœ¨ã®åˆ©ç”¨è€…æ•°
    growth: 10,       // å¹´é–“å¢—åŠ äºˆæ¸¬
    maxRecords: 200   // 5å¹´å¾Œæƒ³å®š
  },
  
  addresses: {
    perUser: 5,       // 1äººã‚ãŸã‚Šå¹³å‡å®›åæ•°
    total: 400,       // ç¾åœ¨æƒ³å®š
    maxRecords: 1000  // å°†æ¥æƒ³å®š
  },
  
  shipping: {
    perDay: 10,       // 1æ—¥å¹³å‡ç™ºé€ä»¶æ•°
    perYear: 2500,    // å¹´é–“ç™ºé€ä»¶æ•°
    maxRecords: 15000 // 5å¹´é–“ç´¯ç©
  }
};
```

---

## âš¡ å°è¦æ¨¡ç‰¹åŒ–ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨­è¨ˆ

### è»½é‡åŒ–ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹
```javascript
/**
 * å°è¦æ¨¡é‹ç”¨ç‰¹åŒ– - ã‚·ãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿æ“ä½œ
 */
const SimpleDB = {
  
  // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼ˆå°è¦æ¨¡ãªã®ã§å…¨ãƒ‡ãƒ¼ã‚¿ã‚­ãƒ£ãƒƒã‚·ãƒ¥å¯èƒ½ï¼‰
  cache: {
    customers: null,
    addresses: null,
    lastUpdate: null
  },
  
  /**
   * å…¨é¡§å®¢ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥æ´»ç”¨ï¼‰
   */
  getAllCustomers() {
    const now = new Date();
    
    // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒ10åˆ†ä»¥å†…ãªã‚‰å†åˆ©ç”¨
    if (this.cache.customers && 
        this.cache.lastUpdate && 
        (now - this.cache.lastUpdate) < 600000) {
      console.log('ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰é¡§å®¢ãƒ‡ãƒ¼ã‚¿å–å¾—');
      return this.cache.customers;
    }
    
    // Spreadsheetã‹ã‚‰å–å¾—
    const sheet = SpreadsheetApp.openById(CONFIG.SPREADSHEET_ID)
                                .getSheetByName('Customers');
    
    const data = sheet.getDataRange().getValues();
    
    if (data.length <= 1) {
      this.cache.customers = [];
    } else {
      const headers = data[0];
      this.cache.customers = data.slice(1).map(row => 
        this.rowToObject(row, headers)
      );
    }
    
    this.cache.lastUpdate = now;
    console.log(`é¡§å®¢ãƒ‡ãƒ¼ã‚¿å–å¾—: ${this.cache.customers.length}ä»¶`);
    
    return this.cache.customers;
  },
  
  /**
   * ç™ºé€è¨˜éŒ²ä¿å­˜ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ç‰ˆï¼‰
   */
  saveShipping(shippingData) {
    const sheet = SpreadsheetApp.openById(CONFIG.SPREADSHEET_ID)
                                .getSheetByName('Shipping');
    
    const id = `SHIP_${Date.now()}`;
    const now = new Date();
    
    // æ–™é‡‘è¨ˆç®—
    const fee = this.calculateFee(shippingData);
    
    const row = [
      id,
      shippingData.customerId,
      shippingData.addressId,
      shippingData.shippingMethod,
      shippingData.weight || 0,
      fee,
      shippingData.isExpress ? 'é€Ÿé”' : 'é€šå¸¸',
      shippingData.trackingNumber || '',
      now, // ç™ºé€æ—¥
      now  // ä½œæˆæ—¥
    ];
    
    sheet.appendRow(row);
    
    // å±¥æ­´æ›´æ–°ï¼ˆéåŒæœŸçš„ã«å®Ÿè¡Œï¼‰
    this.updateHistoryAsync(shippingData);
    
    return { 
      id: id, 
      fee: fee,
      success: true,
      timestamp: now
    };
  },
  
  /**
   * å±¥æ­´æ›´æ–°ï¼ˆå°è¦æ¨¡ç”¨ã‚·ãƒ³ãƒ—ãƒ«ç‰ˆï¼‰
   */
  updateHistoryAsync(shippingData) {
    try {
      // ãƒ¦ãƒ¼ã‚¶ãƒ¼å±¥æ­´æ›´æ–°
      if (shippingData.userId) {
        this.incrementUserHistory(shippingData.userId, shippingData.addressId);
      }
      
      // å®›åä½¿ç”¨çµ±è¨ˆæ›´æ–°
      this.incrementAddressUsage(shippingData.addressId);
      
    } catch (error) {
      console.error('å±¥æ­´æ›´æ–°ã‚¨ãƒ©ãƒ¼ï¼ˆå‡¦ç†ç¶™ç¶šï¼‰:', error);
      // ã‚¨ãƒ©ãƒ¼ã§ã‚‚ç™ºé€è¨˜éŒ²ã¯æˆåŠŸã—ã¦ã„ã‚‹ã®ã§å‡¦ç†ç¶™ç¶š
    }
  },
  
  /**
   * æ–™é‡‘è¨ˆç®—ï¼ˆæ–°ä»•æ§˜å¯¾å¿œï¼‰
   */
  calculateFee(data) {
    const { shippingMethod, weight = 50, isExpress = false } = data;
    let fee = 0;
    
    switch (shippingMethod) {
      case 'standard_regular':
        // æ™®é€šéƒµä¾¿ï¼ˆè¦æ ¼å†…ï¼‰
        if (weight <= 50) fee = 140;
        else if (weight <= 100) fee = 180;
        else if (weight <= 150) fee = 270;
        else fee = 320;
        break;
        
      case 'standard_irregular':
        // æ™®é€šéƒµä¾¿ï¼ˆè¦æ ¼å¤–ï¼‰
        if (weight <= 50) fee = 260;
        else if (weight <= 100) fee = 290;
        else if (weight <= 150) fee = 390;
        else fee = 450;
        break;
        
      case 'letterpack':
        fee = 430; // ãƒ¬ã‚¿ãƒ¼ãƒ‘ãƒƒã‚¯ãƒ©ã‚¤ãƒˆå›ºå®š
        break;
        
      default:
        fee = 140; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
    }
    
    // é€Ÿé”ã‚ªãƒ—ã‚·ãƒ§ãƒ³
    if (isExpress) fee += 250;
    
    return fee;
  }
};
```

---

## ğŸ¨ å°è¦æ¨¡ç‰¹åŒ–UIè¨­è¨ˆ

### ã‚·ãƒ³ãƒ—ãƒ«ãªå˜ä¸€ãƒšãƒ¼ã‚¸ã‚¢ãƒ—ãƒª
```html
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PM001 éƒµä¾¿ç‰©ç™ºé€ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </title>
    
    <!-- Bootstrap CDNï¼ˆè»½é‡ç‰ˆï¼‰ -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        /* å°è¦æ¨¡é‹ç”¨ç‰¹åŒ–ã‚¹ã‚¿ã‚¤ãƒ« */
        .small-scale-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 15px;
        }
        
        .compact-form .form-control {
            font-size: 0.9rem;
            padding: 0.5rem;
        }
        
        .quick-access {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .status-indicator {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(40, 167, 69, 0.9);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            z-index: 1000;
        }
        
        /* 80åå¯¾å¿œ - æ¤œç´¢é‡è¦– */
        .user-search {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .quick-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .quick-buttons button {
            flex: 1;
            min-width: 150px;
        }
        
        @media (max-width: 768px) {
            .quick-buttons {
                flex-direction: column;
            }
            
            .quick-buttons button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹è¡¨ç¤º -->
    <div class="status-indicator" id="systemStatus">
        <i class="fas fa-circle text-success"></i> ã‚·ã‚¹ãƒ†ãƒ ç¨¼åƒä¸­ (5/80å)
    </div>
    
    <div class="small-scale-container">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <div class="quick-access text-center">
            <h2><i class="fas fa-mail-bulk me-2"></i>PM001 ç™ºé€ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </h2>
            <p class="mb-0">å°è¦æ¨¡é‹ç”¨æœ€é©åŒ–ç‰ˆ - ç°¡å˜ãƒ»é«˜é€Ÿãƒ»ç¢ºå®Ÿ</p>
        </div>
        
        <!-- ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹ -->
        <div class="quick-buttons">
            <button class="btn btn-primary" onclick="showQuickShipping()">
                <i class="fas fa-shipping-fast me-1"></i>ç™ºé€ç™»éŒ²
            </button>
            <button class="btn btn-info" onclick="showQuickSearch()">
                <i class="fas fa-search me-1"></i>é¡§å®¢æ¤œç´¢
            </button>
            <button class="btn btn-success" onclick="showQuickCalculator()">
                <i class="fas fa-calculator me-1"></i>æ–™é‡‘è¨ˆç®—
            </button>
            <button class="btn btn-warning" onclick="showHistory()">
                <i class="fas fa-history me-1"></i>ç™ºé€å±¥æ­´
            </button>
        </div>
        
        <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¤œç´¢ -->
        <div class="user-search">
            <div class="row">
                <div class="col-md-8">
                    <input type="text" class="form-control" id="globalSearch" 
                           placeholder="é¡§å®¢åãƒ»ä¼šç¤¾åãƒ»å®›åã§æ¤œç´¢..." 
                           onkeyup="performQuickSearch(this.value)">
                </div>
                <div class="col-md-4">
                    <select class="form-control" id="searchFilter">
                        <option value="all">ã™ã¹ã¦</option>
                        <option value="customer">é¡§å®¢ã®ã¿</option>
                        <option value="address">å®›åã®ã¿</option>
                        <option value="recent">æœ€è¿‘ä½¿ç”¨</option>
                    </select>
                </div>
            </div>
            <div id="searchResults" class="mt-3" style="display:none;"></div>
        </div>
        
        <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢ -->
        <div id="mainContent">
            <!-- å‹•çš„ã«ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒè¡¨ç¤ºã•ã‚Œã‚‹ -->
        </div>
        
        <!-- ãƒ•ãƒƒã‚¿ãƒ¼ -->
        <div class="text-center mt-4 text-muted">
            <small>
                PM001 v2.0 | GASå°è¦æ¨¡é‹ç”¨ç‰ˆ | 
                æœ€å¤§80åå¯¾å¿œãƒ»åŒæ™‚5æ¥ç¶šæœ€é©åŒ–
            </small>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // å°è¦æ¨¡é‹ç”¨ç‰¹åŒ–JavaScript
        const App = {
            baseUrl: '', // GAS WebAppURL
            users: [], // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿
            addresses: [], // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚ŒãŸå®›åãƒ‡ãƒ¼ã‚¿
            
            // åˆæœŸåŒ–
            async init() {
                try {
                    this.baseUrl = window.location.href;
                    await this.loadInitialData();
                    this.setupEventListeners();
                    this.showQuickShipping(); // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆç”»é¢
                } catch (error) {
                    console.error('åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
                    this.showError('ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            },
            
            // åˆæœŸãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ï¼ˆå°è¦æ¨¡ãªã®ã§å…¨ãƒ‡ãƒ¼ã‚¿ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼‰
            async loadInitialData() {
                const [customers, addresses] = await Promise.all([
                    this.api('getData', { type: 'customers' }),
                    this.api('getData', { type: 'addresses' })
                ]);
                
                this.users = customers.data || [];
                this.addresses = addresses.data || [];
                
                console.log(`ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å®Œäº†: é¡§å®¢${this.users.length}ä»¶ã€å®›å${this.addresses.length}ä»¶`);
            },
            
            // ã‚¯ã‚¤ãƒƒã‚¯ç™ºé€ç”»é¢
            showQuickShipping() {
                const html = `
                    <div class="card">
                        <div class="card-header">
                            <h5><i class="fas fa-shipping-fast me-2"></i>ç™ºé€ç™»éŒ²</h5>
                        </div>
                        <div class="card-body">
                            <form id="quickShippingForm" class="compact-form">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">å®›åé¸æŠ</label>
                                        <select class="form-control" id="addressSelect" required>
                                            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">ç™ºé€æ–¹æ³•</label>
                                        <select class="form-control" id="shippingMethod" required onchange="updateFeePreview()">
                                            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                                            <option value="standard_regular">æ™®é€šéƒµä¾¿ï¼ˆè¦æ ¼å†…ï¼‰</option>
                                            <option value="standard_irregular">æ™®é€šéƒµä¾¿ï¼ˆè¦æ ¼å¤–ï¼‰</option>
                                            <option value="letterpack">ãƒ¬ã‚¿ãƒ¼ãƒ‘ãƒƒã‚¯ãƒ©ã‚¤ãƒˆ</option>
                                        </select>
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <label class="form-label">é‡é‡(g)</label>
                                        <input type="number" class="form-control" id="weight" value="50" min="1" onchange="updateFeePreview()">
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <label class="form-label">ã‚ªãƒ—ã‚·ãƒ§ãƒ³</label>
                                        <div class="form-check">
                                            <input type="checkbox" class="form-check-input" id="isExpress" onchange="updateFeePreview()">
                                            <label class="form-check-label">é€Ÿé”(+250å††)</label>
                                        </div>
                                    </div>
                                    <div class="col-md-4 mb-3" id="trackingField" style="display:none;">
                                        <label class="form-label">è¿½è·¡ç•ªå·</label>
                                        <input type="text" class="form-control" id="trackingNumber" placeholder="ãƒ¬ã‚¿ãƒ¼ãƒ‘ãƒƒã‚¯è¿½è·¡ç•ªå·">
                                    </div>
                                </div>
                                
                                <div id="feePreview" class="alert alert-info" style="display:none;">
                                    <strong>æ–™é‡‘: <span id="calculatedFee">0</span>å††</strong>
                                </div>
                                
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save me-1"></i>ç™ºé€è¨˜éŒ²ã‚’ä¿å­˜
                                </button>
                            </form>
                        </div>
                    </div>
                `;
                
                document.getElementById('mainContent').innerHTML = html;
                this.populateAddressSelect();
                this.setupQuickShippingForm();
            },
            
            // APIå‘¼ã³å‡ºã—ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ç‰ˆï¼‰
            async api(action, data = {}) {
                try {
                    const response = await fetch(this.baseUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ action, data })
                    });
                    
                    return await response.json();
                } catch (error) {
                    console.error('APIå‘¼ã³å‡ºã—ã‚¨ãƒ©ãƒ¼:', error);
                    throw error;
                }
            }
        };
        
        // å°è¦æ¨¡é‹ç”¨ç‰¹åŒ–ã®æ¤œç´¢æ©Ÿèƒ½
        function performQuickSearch(query) {
            if (query.length < 2) {
                document.getElementById('searchResults').style.display = 'none';
                return;
            }
            
            const results = [];
            const lowerQuery = query.toLowerCase();
            
            // é¡§å®¢æ¤œç´¢
            App.users.forEach(user => {
                if (user.name.toLowerCase().includes(lowerQuery) || 
                    (user.companyName && user.companyName.toLowerCase().includes(lowerQuery))) {
                    results.push({
                        type: 'customer',
                        data: user,
                        display: `${user.name} ${user.companyName ? '(' + user.companyName + ')' : ''}`
                    });
                }
            });
            
            // å®›åæ¤œç´¢
            App.addresses.forEach(addr => {
                if (addr.recipientName.toLowerCase().includes(lowerQuery)) {
                    results.push({
                        type: 'address',
                        data: addr,
                        display: `${addr.recipientName} (${addr.address})`
                    });
                }
            });
            
            displaySearchResults(results.slice(0, 10)); // æœ€å¤§10ä»¶è¡¨ç¤º
        }
        
        function displaySearchResults(results) {
            const container = document.getElementById('searchResults');
            
            if (results.length === 0) {
                container.innerHTML = '<div class="text-muted">è©²å½“ã™ã‚‹çµæœãŒã‚ã‚Šã¾ã›ã‚“</div>';
            } else {
                let html = '<div class="list-group">';
                results.forEach(result => {
                    html += `
                        <a href="#" class="list-group-item list-group-item-action" 
                           onclick="selectSearchResult('${result.type}', '${result.data.id}')">
                            <i class="fas fa-${result.type === 'customer' ? 'user' : 'map-marker-alt'} me-2"></i>
                            ${result.display}
                        </a>
                    `;
                });
                html += '</div>';
                container.innerHTML = html;
            }
            
            container.style.display = 'block';
        }
        
        // æ–™é‡‘ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ›´æ–°
        function updateFeePreview() {
            const method = document.getElementById('shippingMethod').value;
            const weight = parseInt(document.getElementById('weight').value) || 50;
            const isExpress = document.getElementById('isExpress').checked;
            
            if (!method) {
                document.getElementById('feePreview').style.display = 'none';
                return;
            }
            
            // è¿½è·¡ç•ªå·ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¡¨ç¤ºåˆ¶å¾¡
            const trackingField = document.getElementById('trackingField');
            if (method === 'letterpack') {
                trackingField.style.display = 'block';
            } else {
                trackingField.style.display = 'none';
                document.getElementById('trackingNumber').value = '';
            }
            
            // æ–™é‡‘è¨ˆç®—ï¼ˆãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§å³åº§è¨ˆç®—ï¼‰
            let fee = 0;
            switch (method) {
                case 'standard_regular':
                    if (weight <= 50) fee = 140;
                    else if (weight <= 100) fee = 180;
                    else if (weight <= 150) fee = 270;
                    else fee = 320;
                    break;
                case 'standard_irregular':
                    if (weight <= 50) fee = 260;
                    else if (weight <= 100) fee = 290;
                    else if (weight <= 150) fee = 390;
                    else fee = 450;
                    break;
                case 'letterpack':
                    fee = 430;
                    break;
            }
            
            if (isExpress) fee += 250;
            
            document.getElementById('calculatedFee').textContent = fee;
            document.getElementById('feePreview').style.display = 'block';
        }
        
        // åˆæœŸåŒ–å®Ÿè¡Œ
        document.addEventListener('DOMContentLoaded', () => {
            App.init();
        });
    </script>
</body>
</html>
```

---

## ğŸ”’ å°è¦æ¨¡ç‰¹åŒ–ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

### GASåŸºæœ¬ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ï¼ˆ80åé‹ç”¨ï¼‰
```javascript
/**
 * å°è¦æ¨¡é‹ç”¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š
 */
const SecurityConfig = {
  MAX_CONCURRENT_USERS: 5,
  SESSION_TIMEOUT: 3600000, // 1æ™‚é–“
  MAX_REQUESTS_PER_MINUTE: 60,
  
  // ãƒ¦ãƒ¼ã‚¶ãƒ¼è­˜åˆ¥ï¼ˆç°¡æ˜“ç‰ˆï¼‰
  getCurrentUser() {
    return Session.getActiveUser().getEmail();
  },
  
  // ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ï¼ˆç°¡æ˜“ç‰ˆï¼‰
  isAuthorizedUser(email) {
    // å®Ÿè£…ä¾‹ï¼šæ‰¿èªæ¸ˆã¿ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒã‚§ãƒƒã‚¯
    const allowedDomains = ['company.com', 'example.co.jp'];
    const domain = email.split('@')[1];
    return allowedDomains.includes(domain);
  },
  
  // ãƒ¬ãƒ¼ãƒˆåˆ¶é™ï¼ˆåŸºæœ¬ç‰ˆï¼‰
  checkRateLimit(userEmail) {
    const key = `rate_${userEmail}`;
    const cache = CacheService.getScriptCache();
    
    const current = cache.get(key) || 0;
    if (current >= this.MAX_REQUESTS_PER_MINUTE) {
      throw new Error('ã‚¢ã‚¯ã‚»ã‚¹éå¤šã§ã™ã€‚ã—ã°ã‚‰ãå¾…ã£ã¦ã‹ã‚‰ãŠè©¦ã—ãã ã•ã„ã€‚');
    }
    
    cache.put(key, parseInt(current) + 1, 60); // 1åˆ†é–“ä¿æŒ
  }
};
```

---

## ğŸ“Š å°è¦æ¨¡é‹ç”¨ç›£è¦–

### åˆ©ç”¨çŠ¶æ³ç›£è¦–ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ç‰ˆï¼‰
```javascript
/**
 * å°è¦æ¨¡é‹ç”¨ç›£è¦–æ©Ÿèƒ½
 */
const MonitoringSimple = {
  
  // åˆ©ç”¨çŠ¶æ³è¨˜éŒ²
  logUsage(action, userId) {
    try {
      const sheet = SpreadsheetApp.openById(CONFIG.SPREADSHEET_ID)
                                  .getSheetByName('SystemLog');
      
      sheet.appendRow([
        new Date(),
        userId,
        action,
        Session.getActiveUser().getEmail()
      ]);
      
    } catch (error) {
      console.error('ãƒ­ã‚°è¨˜éŒ²ã‚¨ãƒ©ãƒ¼:', error);
    }
  },
  
  // åŒæ™‚æ¥ç¶šæ•°ãƒã‚§ãƒƒã‚¯
  getCurrentConnections() {
    const cache = CacheService.getScriptCache();
    const connections = cache.get('active_connections') || '[]';
    return JSON.parse(connections);
  },
  
  // æ—¥æ¬¡çµ±è¨ˆå–å¾—
  getDailyStats() {
    const sheet = SpreadsheetApp.openById(CONFIG.SPREADSHEET_ID)
                                .getSheetByName('SystemLog');
    
    const today = new Date();
    const todayStr = Utilities.formatDate(today, 'Asia/Tokyo', 'yyyy-MM-dd');
    
    const data = sheet.getDataRange().getValues();
    const todayLogs = data.filter(row => {
      if (row[0] instanceof Date) {
        const logDate = Utilities.formatDate(row[0], 'Asia/Tokyo', 'yyyy-MM-dd');
        return logDate === todayStr;
      }
      return false;
    });
    
    const uniqueUsers = new Set(todayLogs.map(row => row[1])).size;
    const totalActions = todayLogs.length;
    
    return {
      date: todayStr,
      uniqueUsers: uniqueUsers,
      totalActions: totalActions,
      maxConcurrent: Math.min(uniqueUsers, 5) // å®Ÿéš›ã®åŒæ™‚æ¥ç¶šã¯æ¨å®š
    };
  }
};
```

---

## ğŸš€ ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ»é‹ç”¨æ‰‹é †ï¼ˆå°è¦æ¨¡ç‰¹åŒ–ï¼‰

### 5åˆ†ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †
1. **Google Apps Scriptä½œæˆ** (1åˆ†)
   - https://script.google.com/ ã‚¢ã‚¯ã‚»ã‚¹
   - æ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ â†’ "PM001-PostalSystem"

2. **ãƒ•ã‚¡ã‚¤ãƒ«é…ç½®** (2åˆ†)
   - Code.gs: ãƒ¡ã‚¤ãƒ³ãƒ­ã‚¸ãƒƒã‚¯
   - Database.gs: ãƒ‡ãƒ¼ã‚¿æ“ä½œ
   - WebApp.gs: Webåˆ¶å¾¡
   - index.html: UI
   - appsscript.json: è¨­å®š

3. **WebAppãƒ‡ãƒ—ãƒ­ã‚¤** (1åˆ†)
   - ãƒ‡ãƒ—ãƒ­ã‚¤ â†’ æ–°ã—ã„ãƒ‡ãƒ—ãƒ­ã‚¤
   - ã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒª â†’ å…¨å“¡ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½

4. **åˆæœŸè¨­å®š** (1åˆ†)
   - Webã‚¢ãƒ—ãƒªURLå–å¾—
   - åˆæœŸåŒ–å®Ÿè¡Œ
   - ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ã®å‹•ä½œç¢ºèª

### é‹ç”¨é–‹å§‹ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
- [ ] Webã‚¢ãƒ—ãƒªURLå–å¾—ãƒ»å…±æœ‰
- [ ] 80åã®åˆ©ç”¨è€…ã«URLæ¡ˆå†…
- [ ] åˆå›ãƒ­ã‚°ã‚¤ãƒ³ãƒ»å‹•ä½œãƒ†ã‚¹ãƒˆ
- [ ] ç®¡ç†è€…å‘ã‘æ“ä½œèª¬æ˜æ›¸ä½œæˆ
- [ ] å®šæœŸãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—è¨­å®š

---

## ğŸ“ˆ å°è¦æ¨¡é‹ç”¨æˆåŠŸæŒ‡æ¨™

### é‹ç”¨KPI
| æŒ‡æ¨™ | ç›®æ¨™å€¤ | æ¸¬å®šæ–¹æ³• |
|------|--------|----------|
| ã‚·ã‚¹ãƒ†ãƒ ç¨¼åƒç‡ | 99.5%ä»¥ä¸Š | æ¯æ—¥ã‚¢ã‚¯ã‚»ã‚¹ãƒ†ã‚¹ãƒˆ |
| å¿œç­”æ™‚é–“ | 2ç§’ä»¥å†… | ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“æ„Ÿ |
| åŒæ™‚æ¥ç¶šã‚¨ãƒ©ãƒ¼ | 0ä»¶ | ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ç›£è¦– |
| åˆ©ç”¨è€…æº€è¶³åº¦ | 4.0/5.0ä»¥ä¸Š | æœˆæ¬¡ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆ |

### åŠ¹ç‡åŒ–åŠ¹æœ
- **ç™ºé€å‡¦ç†æ™‚é–“**: å¾“æ¥æ¯”50%çŸ­ç¸®
- **ãƒ‡ãƒ¼ã‚¿å…¥åŠ›ãƒŸã‚¹**: 80%å‰Šæ¸›  
- **éå»å±¥æ­´æ´»ç”¨**: 70%å‘ä¸Š
- **é‹ç”¨ã‚³ã‚¹ãƒˆ**: 100%å‰Šæ¸›ï¼ˆç„¡æ–™ï¼‰

### æ‹¡å¼µæº–å‚™
- **åˆ©ç”¨è€…100åã¾ã§**: ç¾ã‚·ã‚¹ãƒ†ãƒ ã§å¯¾å¿œå¯èƒ½
- **åŒæ™‚æ¥ç¶š10åã¾ã§**: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹èª¿æ•´ã§å¯¾å¿œ
- **ãƒ‡ãƒ¼ã‚¿20,000ä»¶ã¾ã§**: Spreadsheetåˆ¶é™å†…ã§å®‰å…¨

---

## ğŸ¯ å®Ÿè£…å„ªå…ˆåº¦ï¼ˆå°è¦æ¨¡é‹ç”¨ï¼‰

### Phase 1: åŸºæœ¬æ©Ÿèƒ½ï¼ˆå³æ™‚å®Ÿè£…ï¼‰
1. **ç™ºé€è¨˜éŒ²ç™»éŒ²**: æœ€å„ªå…ˆ
2. **æ–™é‡‘è¨ˆç®—**: æ–°ä»•æ§˜å¯¾å¿œ
3. **é¡§å®¢ãƒ»å®›åæ¤œç´¢**: åŸºæœ¬æ©Ÿèƒ½
4. **å±¥æ­´è¡¨ç¤º**: ã‚·ãƒ³ãƒ—ãƒ«ç‰ˆ

### Phase 2: åˆ©ä¾¿æ€§å‘ä¸Šï¼ˆ1é€±é–“å¾Œï¼‰
1. **4ãƒ‘ã‚¿ãƒ¼ãƒ³å®›åé¸æŠ**: UIæ”¹è‰¯
2. **è¿½è·¡ç•ªå·ç®¡ç†**: ãƒ¬ã‚¿ãƒ¼ãƒ‘ãƒƒã‚¯å¯¾å¿œ
3. **ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½**: CSVå‡ºåŠ›
4. **åˆ©ç”¨çµ±è¨ˆ**: åŸºæœ¬ãƒ¬ãƒãƒ¼ãƒˆ

### Phase 3: é‹ç”¨æœ€é©åŒ–ï¼ˆ1ãƒ¶æœˆå¾Œï¼‰
1. **é«˜åº¦æ¤œç´¢**: è¤‡åˆæ¡ä»¶æ¤œç´¢
2. **ãƒãƒƒãƒå‡¦ç†**: ä¸€æ‹¬ç™»éŒ²
3. **è‡ªå‹•åŒ–**: å®šå‹å‡¦ç†
4. **ãƒ¬ãƒãƒ¼ãƒˆ**: è©³ç´°åˆ†æ

---

**ã“ã®æŠ€è¡“ä»•æ§˜æ›¸ã¯ã€80åè¦æ¨¡ãƒ»åŒæ™‚5æ¥ç¶šã¨ã„ã†å°è¦æ¨¡é‹ç”¨ã«æœ€é©åŒ–ã•ã‚ŒãŸGoogle Apps Script ã‚·ã‚¹ãƒ†ãƒ ã®å®Œå…¨è¨­è¨ˆæ›¸ã§ã™ã€‚ç„¡æ–™ã§å®‰å®šã—ãŸé‹ç”¨ã‚’å®Ÿç¾ã—ã¾ã™ã€‚**